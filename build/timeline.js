// Generated by CoffeeScript 1.7.1
(function() {
  var timeline;

  timeline = (function() {
    function timeline(options) {
      this.SVG_NS = 'http://www.w3.org/2000/svg';
      timeline = document.querySelector(options.element);
      this.ele = timeline;
      this.svgEle = this.createSvgElement();
      this.data = options.data;
      this.render();
    }

    timeline.prototype.render = function() {
      this.ele.appendChild(this.svgEle);
      return this.drawTimeline();
    };

    timeline.prototype.createSvgElement = function() {
      var element;
      element = document.createElementNS(this.SVG_NS, 'svg');
      element.setAttribute('width', '100%');
      element.setAttribute('height', '250px');
      element.classList.add('timeline');
      return element;
    };

    timeline.prototype.drawTimeline = function() {
      var averageIndex, canvasSize, datum, end, index, offset, paper, range, start, value, x, xOffsetSize, _i, _len, _ref, _results;
      paper = Snap(this.svgEle);
      canvasSize = parseFloat(getComputedStyle(paper.node)["width"]);
      start = +this.data[0].year;
      end = +this.data[this.data.length - 1].year;
      start--;
      end++;
      end++;
      range = end - start;
      paper.line(0, 200, canvasSize, 200).attr({
        'stroke': 'green',
        'stroke-width': 2
      });
      _ref = this.data;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        datum = _ref[_i];
        x = canvasSize * (datum.year - start) / range;
        paper.circle(x, 200, 6).attr({
          'fill': '#070'
        });
        paper.text(x, 230, datum.year).attr({
          'text-anchor': 'middle',
          'stroke': '#777'
        });
        averageIndex = (datum.values.length - 1) / 2;
        xOffsetSize = 24;
        _results.push((function() {
          var _j, _len1, _ref1, _results1;
          _ref1 = datum.values;
          _results1 = [];
          for (index = _j = 0, _len1 = _ref1.length; _j < _len1; index = ++_j) {
            value = _ref1[index];
            offset = (index - averageIndex) * xOffsetSize;
            _results1.push(paper.text(x + offset, 180, value).attr({
              'text-anchor': 'start',
              'stroke': '#777'
            }).transform('r -45 ' + (x + offset) + ' 180'));
          }
          return _results1;
        })());
      }
      return _results;
    };

    return timeline;

  })();

  window.timeline = timeline;

}).call(this);
